<!DOCTYPE HTML>
<!--
	Minimaxing by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
    <title>One Column - Minimaxing by HTML5 UP</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <!--[if lte IE 8]>
    <script src="assets/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="assets/css/main.css"/>
    <!--[if lte IE 9]>
    <link rel="stylesheet" href="assets/css/ie9.css"/><![endif]-->
    <style>

        table {

            margin: 20px auto;
        }

        table a {
            color: #333333;
            cursor: pointer;
        }

        table.gridtable {
            font-size: 15px;
            color: #333333;
            border-width: 1px;
            border-color: #666666;
            border-collapse: collapse;
            width: 100%;
        }

        table.gridtable th {
            border-width: 1px;
            padding: 8px;
            border-style: solid;
            border-color: #666666;
            background-color: #cecece;
        }

        table.gridtable td {
            border-width: 1px;
            padding: 8px;
            border-style: solid;
            border-color: #666666;
            background-color: #ffffff;
        }

        button {
            border: none;
            /* background: #c0392b; */
            background: #007b9d;
            color: #fff;
            cursor: pointer;
            display: inline-block;
            margin: 3px 2px;
            padding: 2px;
            border-radius: 2px;
        }

        * {
            margin: 0;
            padding: 0;
            border: 0;
        }

        /*table{border-collapse:collapse; border-spacing:0; border:0;width:100%;}*/
        /*table tr td, table tr th{border:1px solid #999; padding:.5em 1em; white-space:nowrap;}*/
        /*.table-first tr th, .table-first tr td{background:#F4F4F4; font-weight:bold;}*/
        /*.table-container table tr td, .table-container tr th{border:0; border-bottom:1px solid #999; border-right:1px solid #999;}*/
        /*.table-container table{border:1px solid #999; border-left:0;}*/
        /*.table-two{position:relative;}*/
        /*!*左边内容是表头名的宽度，根据实际情况而定,你也可以使用百分比*!*/
        /*.table-first{position:absolute; left:0; top:0; width:102px;!*width:20%;*!}*/
        /*!*距离左边表头的内容宽度*!*/
        /*.table-second{padding-left:102px;!*width:20%*!}*/
        /*!*超出部分出现滚动条*!*/
        /*.table-container{width:100%; overflow-y:auto; _overflow:auto;margin: 0 0 10px;}*/
        /*!*IOS滚动条*!*/
        /*.table-container::-webkit-scrollbar*/
        /*{*/
        /*-webkit-appearance: none;*/
        /*width: 14px;*/
        /*height: 14px;*/
        /*}*/
        /*.table-container::-webkit-scrollbar-thumb*/
        /*{*/
        /*border-radius: 8px;*/
        /*border: 3px solid #fff;*/
        /*background-color: rgba(0, 0, 0, .3);*/
        /*}*/

    </style>
</head>
<body>
<div id="page-wrapper">
    <div id="header-wrapper">
        <div class="container">
            <div class="row">
                <div class="12u">
                    <header id="header">
                        <h1><a href="./index.html" id="logo">交通安全综合服务管理平台</a></h1>
                        <nav id="nav">
                            <!-- <a href="index.html" class="current-page-item">主页</a> -->
                            <!-- <a href="twocolumn1.html">新闻</a> -->
                            <a href="./history.html" id="search_history">查询历史</a>
                            <!--<a href="threecolumn.html">关于</a>-->
                            <a href="./login/login.html" id="user_operation" onclick="user_operate(event)">登录</a>
                            <a href="#" id="user_info"></a>
                        </nav>
                    </header>
                </div>
            </div>
        </div>
    </div>
    <div id="main">
        <div class="container">
            <div class="row main-row">
                <div class="12u">

                    <section>
                        <h2>车辆违章详情</h2>

                        <div class="table-container">
                            <table class="gridtable" id="detail_table">
                                <tr>
                                    <th>案件号</th>
                                    <td id="id"></td>
                                </tr>
                                <!--<tr>-->
                                <!--<th>案件名称</th>-->
                                <!--<td id="case_name">戴玉辉机动车驾驶人违反道路通行规定案</td>-->
                                <!--</tr>-->
                                <!--<tr>-->
                                <!--<th>驾驶人</th>-->
                                <!--<td id="people_name">戴玉辉</td>-->
                                <!--</tr>-->
                                <tr>
                                    <th>号牌种类</th>
                                    <td id="type"></td>
                                </tr>
                                <tr>
                                    <th>号牌号码</th>
                                    <td id="car_number"></td>
                                </tr>
                                <tr>
                                    <th>处罚事实</th>
                                    <td id="detail">
                                    </td>
                                </tr>
                                <tr>
                                    <th>驾驶人</th>
                                    <td id="people">
                                    </td>
                                </tr>
                                <tr>
                                    <th>行驶证号</th>
                                    <td id="road_number">
                                    </td>
                                </tr>
                                <tr>
                                    <th>地点</th>
                                    <td id="place">
                                    </td>
                                </tr>
                                <tr>
                                    <th>处罚类别</th>
                                    <td id="punish_type"></td>
                                </tr>
                                <tr>
                                    <th>罚款结果</th>
                                    <td id="punish_result"></td>
                                </tr>
                                <tr>
                                    <th>计分</th>
                                    <td id="point_result"></td>
                                </tr>
                                <!--<tr>-->
                                <!--<th>记分</th>-->
                                <!--<td id="point">记6分</td>-->
                                <!--</tr>-->
                                <tr>
                                    <th>处罚依据</th>
                                    <td id="law"></td>
                                </tr>
                                <!--<tr>-->
                                <!--<th>处罚部门</th>-->
                                <!--<td id="punish_division"></td>-->
                                <!--</tr>-->
                                <tr>
                                    <th>处罚者</th>
                                    <td id="punish_police"></td>
                                </tr>
                                <tr>
                                    <th>处罚者身份</th>
                                    <td id="police_job"></td>
                                </tr>
                                <tr>
                                    <th>处罚行政区</th>
                                    <td id="punish_area"></td>
                                </tr>
                                <tr>
                                    <th>处罚时间</th>
                                    <td id="punish_date"></td>
                                </tr>
                                <tr>
                                    <th>相关证据</th>
                                    <td id="evidence"></td>
                                </tr>
                                <tr>
                                    <th>处理状态</th>
                                    <td id="state"></td>
                                </tr>
                                <tr>
                                    <th>违章处理</th>
                                    <td id="deal">
                                        <button id="button_com" onclick="case_complaint(event)">申诉</button>
                                        <button id="button_pay" onclick="open_pay()">缴交罚款</button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </section>

                </div>
            </div>
        </div>
    </div>
    <div id="footer-wrapper">
        <div class="container">
            <div class="row">
                <div class="8u 12u(mobile)">
                    <section>
                        <h2>相关链接</h2>

                        <div>
                            <div class="row">
                                <div class="6u 12u(mobile)">
                                    <ul class="link-list">
                                        <li><a href="http://www.mps.gov.cn/n16/index.html">中华人民共和国公安部</a></li>
                                        <li><a href="http://www.mps.gov.cn/n16/n85753/">公安部交通管理局</a></li>
                                        <li><a href="http://www.tmri.cn/">公安部交通管理科学研究所</a></li>
                                        <li><a href="http://www.122.cn/">交通安全宣传网</a></li>
                                    </ul>
                                </div>
                                <div class="6u 12u(mobile)">
                                    <ul class="link-list">
                                        <li><a href="http://gab.122.gov.cn/views/cljy.html">车检计算器</a></li>
                                        <li><a href="http://fj.122.gov.cn/veh1/control/Tmriplate.exe">选号控件下载</a></li>
                                        <li><a href="http://www.firefox.com.cn/">火狐浏览器</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </section>

                </div>
                <div class="4u 12u(mobile)">
                    <section>
                        <h2></h2>

                        <p>单位名称：福建省公安厅交警总队<br/>
                            联系地址：福州市杨桥中路120号<br/>
                            邮政编码：350001<br/>
                            联系邮箱：fj122govcn@sohu.com</p>
                        <footer class="controls">
                            <a href="http://fj.122.gov.cn/m/showLxdz/3" class="button">平台业务咨询和技术支持</a>
                        </footer>
                    </section>

                </div>
            </div>
            <div class="row">
                <div class="12u">
                    <div id="copyright">
                        &copy; Untitled. All rights reserved. | Design: <a href="http://html5up.net">HTML5 UP</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="payment"
         style="display: none;position: fixed;width: 50vmin;height: 50vmin; border: solid 1px black;top:25vmin;left:25vmin;background: white;text-align: center">
        <img style="width: 75%;height: 75%" src="images/qr.png"/>
        <br>
        <span><a href="#" onclick="to_pay()">支付宝账号登陆</a></span>
        <br>
        <button style="padding: 2px" onclick="pay_done(event)">已支付</button>
        <button style="padding: 2px" onclick="pay_cancel(event)">取消</button>
    </div>
</div>


<!-- Scripts -->
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/skel.min.js"></script>
<script src="assets/js/skel-viewport.min.js"></script>
<script src="assets/js/util.js"></script>
<!--[if lte IE 8]>
<script src="assets/js/ie/respond.min.js"></script><![endif]-->
<script src="assets/js/main.js"></script>
<script src="assets/js/log.js"></script>
<script>
    function open_pay() {
        $('#payment').show();
    }


    // todo-1 动态支付界面
    function to_pay() {
        // 获取罚款金额
        var case_id = $('#id').text();
        var result = JSON.parse(localStorage.data)['result'];
        for (var i in result) {
            if (result[i].id == case_id) {
                console.log(result[i]);
                localStorage.cost = result[i]['cost'];
                localStorage.car_number = result[i]['car_id'];
            }
        }
        window.open("./支付宝%20-%20网上支付%20安全快速！.html");


        // todo 点击支付宝跳转页面
        // todo 在支付页面读取罚款金额
    }


    // todo-1 支付后修改状态 已处理
    function pay_done(evt) {
        $(evt.target).parent().hide();
        var case_id = $('#id').text();

        // todo-1 已处理
        $.ajax({
            url: 'http://localhost/project_4/weixin/index/payDone/1.json',
            type: 'put',
            data: {
                case_id: case_id
            },
            dataType: 'json',
            success: function (data) {
                console.log(data);

                if (data['isConfirm']) {
//                    跳转至查询结果页
                    console.log(data);
                    to_result()
                } else {
//                     返回主页
                    localStorage.link = JSON.stringify('../index.html');
                    localStorage.link_info = JSON.stringify(data['info']); // 接受服务器发送错误信息
                    location.href = "./login/goto.html";
                }
            },
            error: function (data) {
                console.log(data);
                document.body.innerHTML += data.responseText;
            }
        })

    }


    function to_result() {
        var id = $('#car_number').text();
        var vin;

        $.ajax({
            url: 'http://localhost/project_4/weixin/index/historyInfo/id/' + id + '/vin/' + vin + '/1.json',
            type: 'get',
            dataType: 'json',
            success: function (data) {
                console.log(data);
                localStorage.data = JSON.stringify(data);

                if (data['isConfirm']) {
//                    跳转至查询结果页
                    localStorage.data = JSON.stringify(data);
                    location.href = "./result.html"
                } else {
//                     返回主页
                    localStorage.link = JSON.stringify('../index.html');
                    localStorage.link_info = JSON.stringify(data['info']); // 接受服务器发送错误信息
                    location.href = "./login/goto.html";
                }
            },
            error: function (data) {
                console.log(data);
                document.body.innerHTML += data.responseText;
            }
        });
    }


    // 关闭弹窗
    function pay_cancel(evt) {
        $(evt.target).parent().hide();
    }


    // 识别无效操作 处理
    function illegal_operation() {
        if (!localStorage.case_id) {
            $("#detail_table").children().children().remove();
            $("#detail_table").append('<h1>无效操作 <a href="index.html">返回主页</a></h1>')
        }
    }


    // 获取证据
    function get_evidence(case_id) {

        // 获取证据
        $.ajax({
            url: 'http://localhost/project_4/weixin/index/evidence/1.json',
            type: 'get',
            dataType: 'json',
            data: {
                case_id: case_id
            },
            success: function (data) {
                console.log(data.rs);
                var result = data.rs;
                var row;

                for (var i in result) {
                    console.log(result[i]);

                    if (result[i]['type'] == 'jpg') {

                        $row = "<img style='max-height: 200px;' src='../" + result[i]['url'] + "' / >";

                    } else if (result[i]['type'] == 'mp3') {

                        $row = "<audio  src='../" + result[i]['url'] + "' controls='controls'></audio>";

                    } else if (result[i]['type'] == 'mp4') {

                        $row = "<video style='max-height: 400px;' src='../" + result[i]['url'] + "' controls='controls'></video>";

                    }

                    $('#evidence').append($row).append('<br/>');
                }
            },
            error: function (data) {
                console.log(data);
                document.body.innerHTML += data.responseText;
            }
        });
    }

    // 读取数据
    function read_data() {
        if (!localStorage.case_id) {
            return null
        }

        // 读取数据
        var data = JSON.parse(localStorage.data);
        var case_id = JSON.parse(localStorage.case_id);
        console.log(data);


        // 显示证据
        get_evidence(case_id);


        // 根据 case_id 寻找对应数据
        for (var i in data.result) {
            if (data.result[i]['id'] == case_id) {
                var result = data.result[i];
//                localStorage.removeItem('case_id'); // 删除 localstorage.case_id 避免无效操作
                break;
            }
        }
        console.log(result);

        // 数据可能需要细微调整

        $("#id").text(case_id);
        $("#type").text(result.type);
        $("#car_number").text(result.car_id);
        $("#detail").text(result.content);
        $("#punish_type").text(result.punishment);
        $("#punish_result").text('罚款' + result.cost + '元');
        $("#punish_date").text(result.happentime);
        $("#punish_area").text(result.area);
        $("#law").text(result.law_content);
        $("#punish_police").text(result.police_name);
        $("#police_job").text(result.police_job);
        $("#place").text(result.place);
        $("#state").text(result.state);
        $("#road_number").text(result.drive_card);
        $("#people").text(result.name);
        $("#point_result").text(result.score + '分');

        $("#deal").attr('data-case_id', case_id);


    }

    // 跳转申诉页面
    function case_complaint(evt) {
        localStorage.case_id = $(evt.target).parent().attr('data-case_id');
        location.href = './complaint.html'
    }


    // 根据处理状态调整申诉按钮
    function complaint_button() {
        if ($("#state").text() != '未处理') {
            $('#button_com').hide();
            $('#button_pay').hide().parent().append('<span>暂无可用操作</span>');
        }
    }

    $(function () {
        user_online();

//        illegal_operation();
        read_data();
        complaint_button();
    })
</script>

</body>
</html>